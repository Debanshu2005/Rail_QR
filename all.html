<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Fittings</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
   .azadi-logo {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 240px;
    height: auto;
    z-index: 1000;
}
body {
    background-color: #f8f9fa;
    font-family: 'Roboto', sans-serif;
}
h1 {
    color: #0d6efd;
    font-weight: bold;
}
.card {
    border-radius: 12px;
    border: 2px solid #0d6efd33;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.btn-outline-secondary {
    border-color: #ff9933;
    color: #ff9933;
}
.btn-outline-secondary:hover {
    background-color: #ff9933;
    color: #fff;
}
th, td {
    text-align: center;
    vertical-align: middle;
}
.rail-logo {
    max-height: 50px;
    margin-bottom: 15px;
}
.footer-note {
    font-size: 0.9rem;
    color: #6c757d;
}
.badge-success { background-color: #28a745; }
.badge-danger { background-color: #dc3545; }
</style>
</head>
<body>
<img src="{{ url_for('static', filename='image/azadi.png') }}" alt="Azadi Logo" class="azadi-logo">

<div class="container mt-5">
    <div class="text-center mb-4">
        <img src="{{ url_for('static', filename='image/rail.png') }}" class="rail-logo" alt="Indian Railways Logo">
        <h1>All Fittings</h1>
    </div>

    <div class="card shadow p-4">
        <!-- Sorting Bar -->
        <form method="get" class="mb-3 d-flex justify-content-center align-items-center gap-2">
            <label for="sort_by" class="fw-bold">Sort By:</label>
            <select name="sort_by" id="sort_by" class="form-select w-auto">
              <option value="uid" {% if request.args.get('sort_by')=='uid' %}selected{% endif %}>UID</option>
              <option value="lot" {% if request.args.get('sort_by')=='lot' %}selected{% endif %}>Lot</option>
              <option value="vendor" {% if request.args.get('sort_by')=='vendor' %}selected{% endif %}>Vendor</option>
              <option value="vendor_risk" {% if request.args.get('sort_by')=='vendor_risk' %}selected{% endif %}>Vendor Risk</option>
              <option value="supply_date" {% if request.args.get('sort_by')=='supply_date' %}selected{% endif %}>Supply Date</option>
              <option value="warranty_end" {% if request.args.get('sort_by')=='warranty_end' %}selected{% endif %}>Warranty End</option>
              <option value="risk" {% if request.args.get('sort_by')=='risk' %}selected{% endif %}>Risk</option>
              <option value="item_type" {% if request.args.get('sort_by')=='item_type' %}selected{% endif %}>Item Type</option>
            </select>

            <button type="submit" class="btn btn-outline-secondary">Sort</button>
        </form>

        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>UID</th>
                    <th>Item Type</th>
                    <th>Vendor</th>
                    <th>Lot</th>
                    <th>Supply Date</th>
                    <th>Warranty End</th>
                    <th>UDM Sync</th>
                    <th>TMS Sync</th>
                    <th>Risk Level</th>
                    <th>Vendor Risk</th>
                    <th>QR Code</th>
                    <th>View</th>
                </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                <tr>
                    <td>{{ row['uid'] }}</td>
                    <td>{{ row['item_type'] }}</td>
                    <td>{{ row['vendor'] }}</td>
                    <td>{{ row['lot'] }}</td>
                    <td>{{ row['supply_date'] }}</td>
                    <td>{{ row['warranty_end'] }}</td>
                    <td>{% if row['udm_synced']==1 %}<span class="badge badge-success">Synced</span>{% else %}<span class="badge badge-danger">Pending</span>{% endif %}</td>
                    <td>{% if row['tms_synced']==1 %}<span class="badge badge-success">Synced</span>{% else %}<span class="badge badge-danger">Pending</span>{% endif %}</td>
                    <td>
                        {% if row['risk']=='High' %}<span class="badge bg-danger">High</span>
                        {% elif row['risk']=='Medium' %}<span class="badge bg-warning text-dark">Medium</span>
                        {% else %}<span class="badge bg-success">Low</span>{% endif %}
                    </td>
                    <td>
                        {% if row['vendor_risk']=='High' %}<span class="badge bg-danger">High</span>
                        {% elif row['vendor_risk']=='Medium' %}<span class="badge bg-warning text-dark">Medium</span>
                        {% else %}<span class="badge bg-success">Low</span>{% endif %}
                    </td>
                    <td><img src="{{ url_for('static', filename='qrcodes/' ~ row['uid'] ~ '.png') }}" width="80" alt="QR Code"></td>
                    <td><a href="{{ url_for('view_record', uid=row['uid']) }}" class="btn btn-outline-secondary btn-sm">View</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="mt-3 text-center">
            <a href="/" class="btn btn-outline-secondary">Add New Fitting</a>
        </div>

        <p class="footer-note text-center mt-3">Â© Indian Railways Fittings Department</p>
    </div>
</div>
</body>
</html>
